yarn run v1.22.19
warning ../../../../../../../package.json: No license field
$ FORCE_DEPLOY=true RUN_TESTS=true hardhat run scripts/deploy-with-new-architecture.js
[32minfo[39m: 已成功加载合约地址: 21个合约，18个实现合约 {"timestamp":"2025-03-31T05:07:37.437Z"}
[32minfo[39m: 成功从 /Users/zhangandy/Documents/work/code/party/blockchain/fashi-shijian/japan-rwa/.env 加载环境变量 {"timestamp":"2025-03-31T05:07:37.439Z"}
[32minfo[39m: 成功加载了 5 个角色私钥 {"timestamp":"2025-03-31T05:07:37.439Z"}
[32minfo[39m: 
================================================================================ {"timestamp":"2025-03-31T05:07:37.443Z"}
[32minfo[39m: 【1. 部署环境准备】 {"timestamp":"2025-03-31T05:07:37.443Z"}
[32minfo[39m: ================================================================================
 {"timestamp":"2025-03-31T05:07:37.443Z"}
[32minfo[39m: 部署状态管理初始化完成 {"timestamp":"2025-03-31T05:07:37.719Z"}
[32minfo[39m: 部署网络: hardhat {"timestamp":"2025-03-31T05:07:37.846Z"}
[32minfo[39m: 部署账户: 0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266 {"timestamp":"2025-03-31T05:07:37.858Z"}
[32minfo[39m: 部署账户余额: 10000.0 ETH {"timestamp":"2025-03-31T05:07:37.860Z"}
[32minfo[39m: 部署配置摘要: {"timestamp":"2025-03-31T05:07:37.863Z"}
[32minfo[39m: - 部署策略: upgradeable {"timestamp":"2025-03-31T05:07:37.863Z"}
[32minfo[39m: - 强制重新部署: true {"timestamp":"2025-03-31T05:07:37.863Z"}
[32minfo[39m: - 验证合约: true {"timestamp":"2025-03-31T05:07:37.863Z"}
[32minfo[39m: - 待部署库合约: SystemDeployerLib1, SystemDeployerLib2 {"timestamp":"2025-03-31T05:07:37.863Z"}
[32minfo[39m: 角色配置: {"timestamp":"2025-03-31T05:07:37.863Z"}
[32minfo[39m: 
================================================================================ {"timestamp":"2025-03-31T05:07:37.863Z"}
[32minfo[39m: 【2. 合约系统部署】 {"timestamp":"2025-03-31T05:07:37.863Z"}
[32minfo[39m: ================================================================================
 {"timestamp":"2025-03-31T05:07:37.863Z"}
[32minfo[39m: 开始部署合约系统... {"timestamp":"2025-03-31T05:07:37.864Z"}
[32minfo[39m: 部署策略: upgradeable {"timestamp":"2025-03-31T05:07:37.864Z"}
[32minfo[39m: 强制重新部署: true {"timestamp":"2025-03-31T05:07:37.864Z"}
[32minfo[39m: 开始部署系统库合约... {"timestamp":"2025-03-31T05:07:37.864Z"}
[32minfo[39m: 开始部署库合约... {"timestamp":"2025-03-31T05:07:37.866Z"}
[32minfo[39m: 部署库合约 SystemDeployerLib1... {"timestamp":"2025-03-31T05:07:37.869Z"}
[32minfo[39m: SystemDeployerLib1 预估 gas: 16366368 {"timestamp":"2025-03-31T05:07:37.904Z"}
[32minfo[39m: SystemDeployerLib1 设置 gas 限制: 32732736 {"timestamp":"2025-03-31T05:07:37.904Z"}
[32minfo[39m: 开始部署 SystemDeployerLib1... {"timestamp":"2025-03-31T05:07:37.904Z"}
[32minfo[39m: 使用网络: hardhat {"timestamp":"2025-03-31T05:07:37.906Z"}
[32minfo[39m: SystemDeployerLib1 部署交易已提交: 0x4b2d75f07c51bc8e6a6180c2156bb109a9de3cac49b2c54dc433c98745c9fd77 {"timestamp":"2025-03-31T05:07:37.920Z"}
[32minfo[39m: SystemDeployerLib1 部署交易已确认: 0x4b2d75f07c51bc8e6a6180c2156bb109a9de3cac49b2c54dc433c98745c9fd77 {"timestamp":"2025-03-31T05:07:37.921Z"}
[32minfo[39m: SystemDeployerLib1 部署成功，合约地址: 0x5FbDB2315678afecb367f032d93F642f64180aa3 {"timestamp":"2025-03-31T05:07:37.921Z"}
[32minfo[39m: 部署状态已保存 {"timestamp":"2025-03-31T05:07:37.923Z"}
[32minfo[39m: 部署时间戳已更新: SystemDeployerLib1 {"timestamp":"2025-03-31T05:07:37.923Z"}
[32minfo[39m: 部署状态已保存 {"timestamp":"2025-03-31T05:07:37.923Z"}
[32minfo[39m: 合约地址已更新: systemDeployerLib1 -> 0x5FbDB2315678afecb367f032d93F642f64180aa3 {"timestamp":"2025-03-31T05:07:37.923Z"}
[32minfo[39m: SystemDeployerLib1 已部署: 0x5FbDB2315678afecb367f032d93F642f64180aa3 {"timestamp":"2025-03-31T05:07:37.923Z"}
[32minfo[39m: 部署库合约 SystemDeployerLib2... {"timestamp":"2025-03-31T05:07:37.923Z"}
[32minfo[39m: SystemDeployerLib2 预估 gas: 13657913 {"timestamp":"2025-03-31T05:07:37.939Z"}
[32minfo[39m: SystemDeployerLib2 设置 gas 限制: 27315826 {"timestamp":"2025-03-31T05:07:37.939Z"}
[32minfo[39m: 开始部署 SystemDeployerLib2... {"timestamp":"2025-03-31T05:07:37.939Z"}
[32minfo[39m: 使用网络: hardhat {"timestamp":"2025-03-31T05:07:37.940Z"}
[32minfo[39m: SystemDeployerLib2 部署交易已提交: 0x5d7e6c81f77be4944321fd9487ae45b116459a2c61e5ec3410e104459672b60a {"timestamp":"2025-03-31T05:07:37.949Z"}
[32minfo[39m: SystemDeployerLib2 部署交易已确认: 0x5d7e6c81f77be4944321fd9487ae45b116459a2c61e5ec3410e104459672b60a {"timestamp":"2025-03-31T05:07:37.949Z"}
[32minfo[39m: SystemDeployerLib2 部署成功，合约地址: 0xe7f1725E7734CE288F8367e1Bb143E90bb3F0512 {"timestamp":"2025-03-31T05:07:37.949Z"}
[32minfo[39m: 部署状态已保存 {"timestamp":"2025-03-31T05:07:37.949Z"}
[32minfo[39m: 部署时间戳已更新: SystemDeployerLib2 {"timestamp":"2025-03-31T05:07:37.949Z"}
[32minfo[39m: 部署状态已保存 {"timestamp":"2025-03-31T05:07:37.950Z"}
[32minfo[39m: 合约地址已更新: systemDeployerLib2 -> 0xe7f1725E7734CE288F8367e1Bb143E90bb3F0512 {"timestamp":"2025-03-31T05:07:37.950Z"}
[32minfo[39m: SystemDeployerLib2 已部署: 0xe7f1725E7734CE288F8367e1Bb143E90bb3F0512 {"timestamp":"2025-03-31T05:07:37.950Z"}
[32minfo[39m: 部署可升级合约 RoleManager... {"timestamp":"2025-03-31T05:07:37.950Z"}
[33mwarn[39m: RoleManager 不需要链接库，尝试重新部署... {"timestamp":"2025-03-31T05:07:37.951Z"}
[32minfo[39m: 部署可升级合约 RoleManager... {"timestamp":"2025-03-31T05:07:37.951Z"}
[32minfo[39m: RoleManager 代理地址: 0xCf7Ed3AccA5a467e9e704C703E8D87F634fB0Fc9 {"timestamp":"2025-03-31T05:07:38.093Z"}
[32minfo[39m: RoleManager 实现合约地址: 0x9fE46736679d2D9a65F0992F2272dE9f3c7fa6e0 {"timestamp":"2025-03-31T05:07:38.094Z"}
[32minfo[39m: 部署状态已保存 {"timestamp":"2025-03-31T05:07:38.095Z"}
[32minfo[39m: 部署时间戳已更新: RoleManager {"timestamp":"2025-03-31T05:07:38.095Z"}
[32minfo[39m: 部署状态已保存 {"timestamp":"2025-03-31T05:07:38.095Z"}
[32minfo[39m: 合约地址已更新: roleManager -> 0xCf7Ed3AccA5a467e9e704C703E8D87F634fB0Fc9 {"timestamp":"2025-03-31T05:07:38.095Z"}
[32minfo[39m: 部署状态已保存 {"timestamp":"2025-03-31T05:07:38.095Z"}
[32minfo[39m: 实现合约地址已更新: RoleManager -> 0x9fE46736679d2D9a65F0992F2272dE9f3c7fa6e0 {"timestamp":"2025-03-31T05:07:38.095Z"}
[32minfo[39m: 部署可升级合约 FeeManager... {"timestamp":"2025-03-31T05:07:38.095Z"}
[33mwarn[39m: FeeManager 不需要链接库，尝试重新部署... {"timestamp":"2025-03-31T05:07:38.096Z"}
[32minfo[39m: 部署可升级合约 FeeManager... {"timestamp":"2025-03-31T05:07:38.096Z"}
[32minfo[39m: FeeManager 代理地址: 0x5FC8d32690cc91D4c39d9d3abcBD16989F875707 {"timestamp":"2025-03-31T05:07:38.109Z"}
[32minfo[39m: FeeManager 实现合约地址: 0xDc64a140Aa3E981100a9becA4E685f962f0cF6C9 {"timestamp":"2025-03-31T05:07:38.109Z"}
[32minfo[39m: 部署状态已保存 {"timestamp":"2025-03-31T05:07:38.109Z"}
[32minfo[39m: 部署时间戳已更新: FeeManager {"timestamp":"2025-03-31T05:07:38.109Z"}
[32minfo[39m: 部署状态已保存 {"timestamp":"2025-03-31T05:07:38.109Z"}
[32minfo[39m: 合约地址已更新: feeManager -> 0x5FC8d32690cc91D4c39d9d3abcBD16989F875707 {"timestamp":"2025-03-31T05:07:38.109Z"}
[32minfo[39m: 部署状态已保存 {"timestamp":"2025-03-31T05:07:38.110Z"}
[32minfo[39m: 实现合约地址已更新: FeeManager -> 0xDc64a140Aa3E981100a9becA4E685f962f0cF6C9 {"timestamp":"2025-03-31T05:07:38.110Z"}
[32minfo[39m: 部署可升级合约 PropertyRegistry... {"timestamp":"2025-03-31T05:07:38.110Z"}
[33mwarn[39m: PropertyRegistry 不需要链接库，尝试重新部署... {"timestamp":"2025-03-31T05:07:38.110Z"}
[32minfo[39m: 部署可升级合约 PropertyRegistry... {"timestamp":"2025-03-31T05:07:38.110Z"}
[32minfo[39m: PropertyRegistry 代理地址: 0xa513E6E4b8f2a923D98304ec87F64353C4D5C853 {"timestamp":"2025-03-31T05:07:38.126Z"}
[32minfo[39m: PropertyRegistry 实现合约地址: 0x0165878A594ca255338adfa4d48449f69242Eb8F {"timestamp":"2025-03-31T05:07:38.127Z"}
[32minfo[39m: 部署状态已保存 {"timestamp":"2025-03-31T05:07:38.127Z"}
[32minfo[39m: 部署时间戳已更新: PropertyRegistry {"timestamp":"2025-03-31T05:07:38.127Z"}
[32minfo[39m: 部署状态已保存 {"timestamp":"2025-03-31T05:07:38.127Z"}
[32minfo[39m: 合约地址已更新: propertyRegistry -> 0xa513E6E4b8f2a923D98304ec87F64353C4D5C853 {"timestamp":"2025-03-31T05:07:38.127Z"}
[32minfo[39m: 部署状态已保存 {"timestamp":"2025-03-31T05:07:38.128Z"}
[32minfo[39m: 实现合约地址已更新: PropertyRegistry -> 0x0165878A594ca255338adfa4d48449f69242Eb8F {"timestamp":"2025-03-31T05:07:38.128Z"}
[32minfo[39m: 部署可升级合约 RentDistributor... {"timestamp":"2025-03-31T05:07:38.128Z"}
[33mwarn[39m: RentDistributor 不需要链接库，尝试重新部署... {"timestamp":"2025-03-31T05:07:38.129Z"}
[32minfo[39m: 部署可升级合约 RentDistributor... {"timestamp":"2025-03-31T05:07:38.129Z"}
[32minfo[39m: RentDistributor 代理地址: 0x8A791620dd6260079BF849Dc5567aDC3F2FdC318 {"timestamp":"2025-03-31T05:07:38.142Z"}
[32minfo[39m: RentDistributor 实现合约地址: 0x2279B7A0a67DB372996a5FaB50D91eAA73d2eBe6 {"timestamp":"2025-03-31T05:07:38.142Z"}
[32minfo[39m: 部署状态已保存 {"timestamp":"2025-03-31T05:07:38.142Z"}
[32minfo[39m: 部署时间戳已更新: RentDistributor {"timestamp":"2025-03-31T05:07:38.143Z"}
[32minfo[39m: 部署状态已保存 {"timestamp":"2025-03-31T05:07:38.143Z"}
[32minfo[39m: 合约地址已更新: rentDistributor -> 0x8A791620dd6260079BF849Dc5567aDC3F2FdC318 {"timestamp":"2025-03-31T05:07:38.143Z"}
[32minfo[39m: 部署状态已保存 {"timestamp":"2025-03-31T05:07:38.143Z"}
[32minfo[39m: 实现合约地址已更新: RentDistributor -> 0x2279B7A0a67DB372996a5FaB50D91eAA73d2eBe6 {"timestamp":"2025-03-31T05:07:38.143Z"}
[32minfo[39m: 部署可升级合约 TokenFactory... {"timestamp":"2025-03-31T05:07:38.143Z"}
[33mwarn[39m: TokenFactory 不需要链接库，尝试重新部署... {"timestamp":"2025-03-31T05:07:38.144Z"}
[32minfo[39m: 部署可升级合约 TokenFactory... {"timestamp":"2025-03-31T05:07:38.144Z"}
[32minfo[39m: TokenFactory 代理地址: 0xB7f8BC63BbcaD18155201308C8f3540b07f84F5e {"timestamp":"2025-03-31T05:07:38.157Z"}
[32minfo[39m: TokenFactory 实现合约地址: 0x610178dA211FEF7D417bC0e6FeD39F05609AD788 {"timestamp":"2025-03-31T05:07:38.157Z"}
[32minfo[39m: 部署状态已保存 {"timestamp":"2025-03-31T05:07:38.157Z"}
[32minfo[39m: 部署时间戳已更新: TokenFactory {"timestamp":"2025-03-31T05:07:38.158Z"}
[32minfo[39m: 部署状态已保存 {"timestamp":"2025-03-31T05:07:38.158Z"}
[32minfo[39m: 合约地址已更新: tokenFactory -> 0xB7f8BC63BbcaD18155201308C8f3540b07f84F5e {"timestamp":"2025-03-31T05:07:38.158Z"}
[32minfo[39m: 部署状态已保存 {"timestamp":"2025-03-31T05:07:38.158Z"}
[32minfo[39m: 实现合约地址已更新: TokenFactory -> 0x610178dA211FEF7D417bC0e6FeD39F05609AD788 {"timestamp":"2025-03-31T05:07:38.158Z"}
[32minfo[39m: 部署可升级合约 RedemptionManager... {"timestamp":"2025-03-31T05:07:38.158Z"}
[33mwarn[39m: RedemptionManager 不需要链接库，尝试重新部署... {"timestamp":"2025-03-31T05:07:38.159Z"}
[32minfo[39m: 部署可升级合约 RedemptionManager... {"timestamp":"2025-03-31T05:07:38.159Z"}
[32minfo[39m: RedemptionManager 代理地址: 0x0DCd1Bf9A1b36cE34237eEaFef220932846BCD82 {"timestamp":"2025-03-31T05:07:38.171Z"}
[32minfo[39m: RedemptionManager 实现合约地址: 0xA51c1fc2f0D1a1b8494Ed1FE312d7C3a78Ed91C0 {"timestamp":"2025-03-31T05:07:38.172Z"}
[32minfo[39m: 部署状态已保存 {"timestamp":"2025-03-31T05:07:38.172Z"}
[32minfo[39m: 部署时间戳已更新: RedemptionManager {"timestamp":"2025-03-31T05:07:38.172Z"}
[32minfo[39m: 部署状态已保存 {"timestamp":"2025-03-31T05:07:38.172Z"}
[32minfo[39m: 合约地址已更新: redemptionManager -> 0x0DCd1Bf9A1b36cE34237eEaFef220932846BCD82 {"timestamp":"2025-03-31T05:07:38.172Z"}
[32minfo[39m: 部署状态已保存 {"timestamp":"2025-03-31T05:07:38.172Z"}
[32minfo[39m: 实现合约地址已更新: RedemptionManager -> 0xA51c1fc2f0D1a1b8494Ed1FE312d7C3a78Ed91C0 {"timestamp":"2025-03-31T05:07:38.172Z"}
[32minfo[39m: 部署可升级合约 Marketplace... {"timestamp":"2025-03-31T05:07:38.172Z"}
[33mwarn[39m: Marketplace 不需要链接库，尝试重新部署... {"timestamp":"2025-03-31T05:07:38.173Z"}
[32minfo[39m: 部署可升级合约 Marketplace... {"timestamp":"2025-03-31T05:07:38.173Z"}
[32minfo[39m: Marketplace 代理地址: 0x0B306BF915C4d645ff596e518fAf3F9669b97016 {"timestamp":"2025-03-31T05:07:38.187Z"}
[32minfo[39m: Marketplace 实现合约地址: 0x9A676e781A523b5d0C0e43731313A708CB607508 {"timestamp":"2025-03-31T05:07:38.187Z"}
[32minfo[39m: 部署状态已保存 {"timestamp":"2025-03-31T05:07:38.187Z"}
[32minfo[39m: 部署时间戳已更新: Marketplace {"timestamp":"2025-03-31T05:07:38.187Z"}
[32minfo[39m: 部署状态已保存 {"timestamp":"2025-03-31T05:07:38.187Z"}
[32minfo[39m: 合约地址已更新: marketplace -> 0x0B306BF915C4d645ff596e518fAf3F9669b97016 {"timestamp":"2025-03-31T05:07:38.187Z"}
[32minfo[39m: 部署状态已保存 {"timestamp":"2025-03-31T05:07:38.188Z"}
[32minfo[39m: 实现合约地址已更新: Marketplace -> 0x9A676e781A523b5d0C0e43731313A708CB607508 {"timestamp":"2025-03-31T05:07:38.188Z"}
[32minfo[39m: 部署可升级合约 TokenHolderQuery... {"timestamp":"2025-03-31T05:07:38.188Z"}
[33mwarn[39m: TokenHolderQuery 不需要链接库，尝试重新部署... {"timestamp":"2025-03-31T05:07:38.188Z"}
[32minfo[39m: 部署可升级合约 TokenHolderQuery... {"timestamp":"2025-03-31T05:07:38.188Z"}
[32minfo[39m: TokenHolderQuery 代理地址: 0x9A9f2CCfdE556A7E9Ff0848998Aa4a0CFD8863AE {"timestamp":"2025-03-31T05:07:38.198Z"}
[32minfo[39m: TokenHolderQuery 实现合约地址: 0x959922bE3CAee4b8Cd9a407cc3ac1C251C2007B1 {"timestamp":"2025-03-31T05:07:38.198Z"}
[32minfo[39m: 部署状态已保存 {"timestamp":"2025-03-31T05:07:38.198Z"}
[32minfo[39m: 部署时间戳已更新: TokenHolderQuery {"timestamp":"2025-03-31T05:07:38.198Z"}
[32minfo[39m: 部署状态已保存 {"timestamp":"2025-03-31T05:07:38.198Z"}
[32minfo[39m: 合约地址已更新: tokenHolderQuery -> 0x9A9f2CCfdE556A7E9Ff0848998Aa4a0CFD8863AE {"timestamp":"2025-03-31T05:07:38.198Z"}
[32minfo[39m: 部署状态已保存 {"timestamp":"2025-03-31T05:07:38.199Z"}
[32minfo[39m: 实现合约地址已更新: TokenHolderQuery -> 0x959922bE3CAee4b8Cd9a407cc3ac1C251C2007B1 {"timestamp":"2025-03-31T05:07:38.199Z"}
[32minfo[39m: 部署可升级合约 RealEstateSystem... {"timestamp":"2025-03-31T05:07:38.199Z"}
[33mwarn[39m: RealEstateSystem 不需要链接库，尝试重新部署... {"timestamp":"2025-03-31T05:07:38.199Z"}
[32minfo[39m: 部署可升级合约 RealEstateSystem... {"timestamp":"2025-03-31T05:07:38.199Z"}
[32minfo[39m: RealEstateSystem 代理地址: 0x3Aa5ebB10DC797CAC828524e59A333d0A371443c {"timestamp":"2025-03-31T05:07:38.211Z"}
[32minfo[39m: RealEstateSystem 实现合约地址: 0x68B1D87F95878fE05B998F19b66F4baba5De1aed {"timestamp":"2025-03-31T05:07:38.211Z"}
[32minfo[39m: 部署状态已保存 {"timestamp":"2025-03-31T05:07:38.211Z"}
[32minfo[39m: 部署时间戳已更新: RealEstateSystem {"timestamp":"2025-03-31T05:07:38.211Z"}
[32minfo[39m: 部署状态已保存 {"timestamp":"2025-03-31T05:07:38.212Z"}
[32minfo[39m: 合约地址已更新: realEstateSystem -> 0x3Aa5ebB10DC797CAC828524e59A333d0A371443c {"timestamp":"2025-03-31T05:07:38.212Z"}
[32minfo[39m: 部署状态已保存 {"timestamp":"2025-03-31T05:07:38.212Z"}
[32minfo[39m: 实现合约地址已更新: RealEstateSystem -> 0x68B1D87F95878fE05B998F19b66F4baba5De1aed {"timestamp":"2025-03-31T05:07:38.212Z"}
[32minfo[39m: 系统部署完成，用时 0.35 秒 {"timestamp":"2025-03-31T05:07:38.212Z"}
[32minfo[39m: 合约地址已保存到scripts/deploy-state.json {"timestamp":"2025-03-31T05:07:38.212Z"}
[32minfo[39m: 合约地址已保存到shared/deployments/contracts.json {"timestamp":"2025-03-31T05:07:38.213Z"}
[32minfo[39m: 最新部署记录已保存到: /Users/zhangandy/Documents/work/code/party/blockchain/fashi-shijian/japan-rwa/shared/deployments/hardhat-latest.json {"timestamp":"2025-03-31T05:07:38.213Z"}
[32minfo[39m: 时间戳部署记录已保存到: /Users/zhangandy/Documents/work/code/party/blockchain/fashi-shijian/japan-rwa/scripts/logging/hardhat-2025-03-31T05-07-37.864Z.json {"timestamp":"2025-03-31T05:07:38.213Z"}
[32minfo[39m: 部署摘要已保存到: /Users/zhangandy/Documents/work/code/party/blockchain/fashi-shijian/japan-rwa/scripts/logging/DEPLOYMENT.md {"timestamp":"2025-03-31T05:07:38.214Z"}
[32minfo[39m: 配置系统角色... {"timestamp":"2025-03-31T05:07:38.214Z"}
[32minfo[39m: 角色配置完成 {"timestamp":"2025-03-31T05:07:38.216Z"}
[32minfo[39m: 
================================================================================ {"timestamp":"2025-03-31T05:07:38.216Z"}
[32minfo[39m: 【6. 部署代币实现合约】 {"timestamp":"2025-03-31T05:07:38.216Z"}
[32minfo[39m: ================================================================================
 {"timestamp":"2025-03-31T05:07:38.216Z"}
[32minfo[39m: 开始部署RealEstateToken实现合约... {"timestamp":"2025-03-31T05:07:38.216Z"}
[32minfo[39m: 等待代币实现合约部署完成... {"timestamp":"2025-03-31T05:07:38.223Z"}
[32minfo[39m: RealEstateToken实现合约已部署: 0xc6e7DF5E7b4f2A278906862b61205850344D4e7d {"timestamp":"2025-03-31T05:07:38.223Z"}
[32minfo[39m: 正在更新TokenFactory的代币实现地址... {"timestamp":"2025-03-31T05:07:38.225Z"}
[32minfo[39m: 交易已提交，等待确认... {"timestamp":"2025-03-31T05:07:38.226Z"}
[32minfo[39m: 交易已确认！TokenFactory代币实现地址已更新 {"timestamp":"2025-03-31T05:07:38.226Z"}
[32minfo[39m: 获取到实现合约地址: roleManager => 0x9fE46736679d2D9a65F0992F2272dE9f3c7fa6e0 {"timestamp":"2025-03-31T05:07:38.226Z"}
[32minfo[39m: 获取到实现合约地址: feeManager => 0xDc64a140Aa3E981100a9becA4E685f962f0cF6C9 {"timestamp":"2025-03-31T05:07:38.227Z"}
[32minfo[39m: 获取到实现合约地址: propertyRegistry => 0x0165878A594ca255338adfa4d48449f69242Eb8F {"timestamp":"2025-03-31T05:07:38.227Z"}
[32minfo[39m: 获取到实现合约地址: rentDistributor => 0x2279B7A0a67DB372996a5FaB50D91eAA73d2eBe6 {"timestamp":"2025-03-31T05:07:38.227Z"}
[32minfo[39m: 获取到实现合约地址: tokenFactory => 0x610178dA211FEF7D417bC0e6FeD39F05609AD788 {"timestamp":"2025-03-31T05:07:38.227Z"}
[32minfo[39m: 获取到实现合约地址: redemptionManager => 0xA51c1fc2f0D1a1b8494Ed1FE312d7C3a78Ed91C0 {"timestamp":"2025-03-31T05:07:38.227Z"}
[32minfo[39m: 获取到实现合约地址: marketplace => 0x9A676e781A523b5d0C0e43731313A708CB607508 {"timestamp":"2025-03-31T05:07:38.227Z"}
[32minfo[39m: 获取到实现合约地址: tokenHolderQuery => 0x959922bE3CAee4b8Cd9a407cc3ac1C251C2007B1 {"timestamp":"2025-03-31T05:07:38.227Z"}
[32minfo[39m: 获取到实现合约地址: realEstateSystem => 0x68B1D87F95878fE05B998F19b66F4baba5De1aed {"timestamp":"2025-03-31T05:07:38.228Z"}
[32minfo[39m: 
================================================================================ {"timestamp":"2025-03-31T05:07:38.228Z"}
[32minfo[39m: 【7. 部署验证】 {"timestamp":"2025-03-31T05:07:38.228Z"}
[32minfo[39m: ================================================================================
 {"timestamp":"2025-03-31T05:07:38.228Z"}
[32minfo[39m: 执行部署验证脚本... {"timestamp":"2025-03-31T05:07:38.228Z"}

================================================================================
【1. 验证准备】
================================================================================

正在连接到本地Hardhat节点...
成功连接到节点，当前区块号: 22
加载的合约地址:
代理合约:
  roleManager: 0xCf7Ed3AccA5a467e9e704C703E8D87F634fB0Fc9
  feeManager: 0x5FC8d32690cc91D4c39d9d3abcBD16989F875707
  propertyRegistry: 0xa513E6E4b8f2a923D98304ec87F64353C4D5C853
  rentDistributor: 0x8A791620dd6260079BF849Dc5567aDC3F2FdC318
  tokenFactory: 0xB7f8BC63BbcaD18155201308C8f3540b07f84F5e
  redemptionManager: 0x0DCd1Bf9A1b36cE34237eEaFef220932846BCD82
  marketplace: 0x0B306BF915C4d645ff596e518fAf3F9669b97016
  tokenHolderQuery: 0x9A9f2CCfdE556A7E9Ff0848998Aa4a0CFD8863AE
  realEstateSystem: 0x3Aa5ebB10DC797CAC828524e59A333d0A371443c
  SystemDeployerLib1: 0x5FbDB2315678afecb367f032d93F642f64180aa3
  SystemDeployerLib2: 0xe7f1725E7734CE288F8367e1Bb143E90bb3F0512
  RoleManager: 0xCf7Ed3AccA5a467e9e704C703E8D87F634fB0Fc9
  FeeManager: 0x5FC8d32690cc91D4c39d9d3abcBD16989F875707
  PropertyRegistry: 0xa513E6E4b8f2a923D98304ec87F64353C4D5C853
  RentDistributor: 0x8A791620dd6260079BF849Dc5567aDC3F2FdC318
  TokenFactory: 0xB7f8BC63BbcaD18155201308C8f3540b07f84F5e
  RedemptionManager: 0x0DCd1Bf9A1b36cE34237eEaFef220932846BCD82
  TokenHolderQuery: 0x9A9f2CCfdE556A7E9Ff0848998Aa4a0CFD8863AE
  RealEstateSystem: 0x3Aa5ebB10DC797CAC828524e59A333d0A371443c
  TokenImplementation: 0xc6e7DF5E7b4f2A278906862b61205850344D4e7d
实现合约:
  roleManager: 0x9fE46736679d2D9a65F0992F2272dE9f3c7fa6e0
  feeManager: 0xDc64a140Aa3E981100a9becA4E685f962f0cF6C9
  propertyRegistry: 0x0165878A594ca255338adfa4d48449f69242Eb8F
  rentDistributor: 0x2279B7A0a67DB372996a5FaB50D91eAA73d2eBe6
  tokenFactory: 0x610178dA211FEF7D417bC0e6FeD39F05609AD788
  redemptionManager: 0xA51c1fc2f0D1a1b8494Ed1FE312d7C3a78Ed91C0
  marketplace: 0x9A676e781A523b5d0C0e43731313A708CB607508
  tokenHolderQuery: 0x959922bE3CAee4b8Cd9a407cc3ac1C251C2007B1
  realEstateSystem: 0x68B1D87F95878fE05B998F19b66F4baba5De1aed
  RealEstateToken: 0xc6e7DF5E7b4f2A278906862b61205850344D4e7d

================================================================================
【2. 合约存在性验证】
================================================================================

检查所有合约是否成功部署并具有代码:
验证代理合约存在性...
✅ roleManager 代理合约: 0xCf7Ed3AccA5a467e9e704C703E8D87F634fB0Fc9 - 合约存在
  ✅ roleManager 实现合约: 0x9fE46736679d2D9a65F0992F2272dE9f3c7fa6e0 - 合约存在
✅ feeManager 代理合约: 0x5FC8d32690cc91D4c39d9d3abcBD16989F875707 - 合约存在
  ✅ feeManager 实现合约: 0xDc64a140Aa3E981100a9becA4E685f962f0cF6C9 - 合约存在
✅ propertyRegistry 代理合约: 0xa513E6E4b8f2a923D98304ec87F64353C4D5C853 - 合约存在
  ✅ propertyRegistry 实现合约: 0x0165878A594ca255338adfa4d48449f69242Eb8F - 合约存在
✅ rentDistributor 代理合约: 0x8A791620dd6260079BF849Dc5567aDC3F2FdC318 - 合约存在
  ✅ rentDistributor 实现合约: 0x2279B7A0a67DB372996a5FaB50D91eAA73d2eBe6 - 合约存在
✅ tokenFactory 代理合约: 0xB7f8BC63BbcaD18155201308C8f3540b07f84F5e - 合约存在
  ✅ tokenFactory 实现合约: 0x610178dA211FEF7D417bC0e6FeD39F05609AD788 - 合约存在
✅ redemptionManager 代理合约: 0x0DCd1Bf9A1b36cE34237eEaFef220932846BCD82 - 合约存在
  ✅ redemptionManager 实现合约: 0xA51c1fc2f0D1a1b8494Ed1FE312d7C3a78Ed91C0 - 合约存在
✅ marketplace 代理合约: 0x0B306BF915C4d645ff596e518fAf3F9669b97016 - 合约存在
  ✅ marketplace 实现合约: 0x9A676e781A523b5d0C0e43731313A708CB607508 - 合约存在
✅ tokenHolderQuery 代理合约: 0x9A9f2CCfdE556A7E9Ff0848998Aa4a0CFD8863AE - 合约存在
  ✅ tokenHolderQuery 实现合约: 0x959922bE3CAee4b8Cd9a407cc3ac1C251C2007B1 - 合约存在
✅ realEstateSystem 代理合约: 0x3Aa5ebB10DC797CAC828524e59A333d0A371443c - 合约存在
  ✅ realEstateSystem 实现合约: 0x68B1D87F95878fE05B998F19b66F4baba5De1aed - 合约存在
ℹ️ SystemDeployerLib1: 0x5FbDB2315678afecb367f032d93F642f64180aa3 - 跳过验证
ℹ️ SystemDeployerLib2: 0xe7f1725E7734CE288F8367e1Bb143E90bb3F0512 - 跳过验证
✅ RoleManager 代理合约: 0xCf7Ed3AccA5a467e9e704C703E8D87F634fB0Fc9 - 合约存在
  ✅ RoleManager 实现合约: 0x9fE46736679d2D9a65F0992F2272dE9f3c7fa6e0 - 合约存在
  ℹ️ 自动发现了 RoleManager 的实现合约地址
✅ FeeManager 代理合约: 0x5FC8d32690cc91D4c39d9d3abcBD16989F875707 - 合约存在
  ✅ FeeManager 实现合约: 0xDc64a140Aa3E981100a9becA4E685f962f0cF6C9 - 合约存在
  ℹ️ 自动发现了 FeeManager 的实现合约地址
✅ PropertyRegistry 代理合约: 0xa513E6E4b8f2a923D98304ec87F64353C4D5C853 - 合约存在
  ✅ PropertyRegistry 实现合约: 0x0165878A594ca255338adfa4d48449f69242Eb8F - 合约存在
  ℹ️ 自动发现了 PropertyRegistry 的实现合约地址
✅ RentDistributor 代理合约: 0x8A791620dd6260079BF849Dc5567aDC3F2FdC318 - 合约存在
  ✅ RentDistributor 实现合约: 0x2279B7A0a67DB372996a5FaB50D91eAA73d2eBe6 - 合约存在
  ℹ️ 自动发现了 RentDistributor 的实现合约地址
✅ TokenFactory 代理合约: 0xB7f8BC63BbcaD18155201308C8f3540b07f84F5e - 合约存在
  ✅ TokenFactory 实现合约: 0x610178dA211FEF7D417bC0e6FeD39F05609AD788 - 合约存在
  ℹ️ 自动发现了 TokenFactory 的实现合约地址
✅ RedemptionManager 代理合约: 0x0DCd1Bf9A1b36cE34237eEaFef220932846BCD82 - 合约存在
  ✅ RedemptionManager 实现合约: 0xA51c1fc2f0D1a1b8494Ed1FE312d7C3a78Ed91C0 - 合约存在
  ℹ️ 自动发现了 RedemptionManager 的实现合约地址
✅ TokenHolderQuery 代理合约: 0x9A9f2CCfdE556A7E9Ff0848998Aa4a0CFD8863AE - 合约存在
  ✅ TokenHolderQuery 实现合约: 0x959922bE3CAee4b8Cd9a407cc3ac1C251C2007B1 - 合约存在
  ℹ️ 自动发现了 TokenHolderQuery 的实现合约地址
✅ RealEstateSystem 代理合约: 0x3Aa5ebB10DC797CAC828524e59A333d0A371443c - 合约存在
  ✅ RealEstateSystem 实现合约: 0x68B1D87F95878fE05B998F19b66F4baba5De1aed - 合约存在
  ℹ️ 自动发现了 RealEstateSystem 的实现合约地址
✅ TokenImplementation: 0xc6e7DF5E7b4f2A278906862b61205850344D4e7d - 合约存在（非代理合约）

验证记录的实现合约存在性...
✅ roleManager 实现合约: 0x9fE46736679d2D9a65F0992F2272dE9f3c7fa6e0 - 合约存在
✅ feeManager 实现合约: 0xDc64a140Aa3E981100a9becA4E685f962f0cF6C9 - 合约存在
✅ propertyRegistry 实现合约: 0x0165878A594ca255338adfa4d48449f69242Eb8F - 合约存在
✅ rentDistributor 实现合约: 0x2279B7A0a67DB372996a5FaB50D91eAA73d2eBe6 - 合约存在
✅ tokenFactory 实现合约: 0x610178dA211FEF7D417bC0e6FeD39F05609AD788 - 合约存在
✅ redemptionManager 实现合约: 0xA51c1fc2f0D1a1b8494Ed1FE312d7C3a78Ed91C0 - 合约存在
✅ marketplace 实现合约: 0x9A676e781A523b5d0C0e43731313A708CB607508 - 合约存在
✅ tokenHolderQuery 实现合约: 0x959922bE3CAee4b8Cd9a407cc3ac1C251C2007B1 - 合约存在
✅ realEstateSystem 实现合约: 0x68B1D87F95878fE05B998F19b66F4baba5De1aed - 合约存在
✅ RealEstateToken 实现合约: 0xc6e7DF5E7b4f2A278906862b61205850344D4e7d - 合约存在
✅ RoleManager 实现合约: 0x9fE46736679d2D9a65F0992F2272dE9f3c7fa6e0 - 合约存在
✅ FeeManager 实现合约: 0xDc64a140Aa3E981100a9becA4E685f962f0cF6C9 - 合约存在
✅ PropertyRegistry 实现合约: 0x0165878A594ca255338adfa4d48449f69242Eb8F - 合约存在
✅ RentDistributor 实现合约: 0x2279B7A0a67DB372996a5FaB50D91eAA73d2eBe6 - 合约存在
✅ TokenFactory 实现合约: 0x610178dA211FEF7D417bC0e6FeD39F05609AD788 - 合约存在
✅ RedemptionManager 实现合约: 0xA51c1fc2f0D1a1b8494Ed1FE312d7C3a78Ed91C0 - 合约存在
✅ TokenHolderQuery 实现合约: 0x959922bE3CAee4b8Cd9a407cc3ac1C251C2007B1 - 合约存在
✅ RealEstateSystem 实现合约: 0x68B1D87F95878fE05B998F19b66F4baba5De1aed - 合约存在

================================================================================
【3. 系统引用验证】
================================================================================

检查RealEstateSystem是否正确引用了所有子系统合约:
✅ RoleManager: 0xcf7ed3acca5a467e9e704c703e8d87f634fb0fc9 - 引用正确
✅ FeeManager: 0x5fc8d32690cc91d4c39d9d3abcbd16989f875707 - 引用正确
✅ PropertyRegistry: 0xa513e6e4b8f2a923d98304ec87f64353c4d5c853 - 引用正确
✅ TokenFactory: 0xb7f8bc63bbcad18155201308c8f3540b07f84f5e - 引用正确
✅ RedemptionManager: 0x0dcd1bf9a1b36ce34237eeafef220932846bcd82 - 引用正确
✅ RentDistributor: 0x8a791620dd6260079bf849dc5567adc3f2fdc318 - 引用正确
✅ Marketplace: 0x0b306bf915c4d645ff596e518faf3f9669b97016 - 引用正确
✅ TokenHolderQuery: 0x9a9f2ccfde556a7e9ff0848998aa4a0cfd8863ae - 引用正确

================================================================================
【4. 角色设置验证】
================================================================================

检查角色管理器是否正确设置:
✅ SuperAdmin角色: 0xd980155b32cf66e6af51e0972d64b9d5efe0e6f237dfaa4bdc83f990dd79e9c8
✅ PropertyManager角色: 0x5cefc88e2d50f91b66109b6bb76803f11168ca3d1cee10cbafe864e4749970c7
✅ 部署账户 0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266 已分配SuperAdmin角色

================================================================================
【5. 关键合约设置验证】
================================================================================

检查关键合约设置:
✅ TokenFactory实现地址已设置: 0xc6e7DF5E7b4f2A278906862b61205850344D4e7d
✅ TokenFactory当前设置的实现地址匹配: 0xc6e7DF5E7b4f2A278906862b61205850344D4e7d
ℹ️ 跳过代币实现合约代码检查（在Hardhat测试环境下可能不准确）

================================================================================
【6. 部署文件格式升级】
================================================================================

检查是否需要升级部署文件格式:
✅ 已将发现的实现合约地址更新到部署文件中

================================================================================
【7. 验证总结】
================================================================================

✅ 所有验证通过! 合约部署成功.
已完成以下验证:
- 合约存在性验证 ✓
- 系统引用验证 ✓
- 角色管理验证 ✓
- TokenFactory设置验证 ✓
[32minfo[39m: 部署验证成功! {"timestamp":"2025-03-31T05:07:38.248Z"}
[32minfo[39m: 
================================================================================ {"timestamp":"2025-03-31T05:07:38.248Z"}
[32minfo[39m: 【8. 运行集成测试】 {"timestamp":"2025-03-31T05:07:38.248Z"}
[32minfo[39m: ================================================================================
 {"timestamp":"2025-03-31T05:07:38.248Z"}
[32minfo[39m: 执行基本流程测试... {"timestamp":"2025-03-31T05:07:38.249Z"}
=== 基础业务流程测试开始 ===
=== 基础业务流程测试开始 ===
测试账户: 0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266 (超级管理员)
测试账户: 0x70997970C51812dc3A010C7d01b50e0d17dc79C8 (用户1)
测试账户: 0x3C44CdDdB6a900fa2b585dd299e03d12FA4293BC (用户2)
测试账户: 0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266 (超级管理员)
测试账户: 0x70997970C51812dc3A010C7d01b50e0d17dc79C8 (用户1)
测试账户: 0x3C44CdDdB6a900fa2b585dd299e03d12FA4293BC (用户2)

--- 测试1: 角色验证 ---

--- 测试1: 角色验证 ---
管理员拥有SUPER_ADMIN角色: true
✅ 角色权限验证成功

--- 测试2: 房产注册和查询 ---
管理员拥有SUPER_ADMIN角色: true
✅ 角色权限验证成功

--- 测试2: 房产注册和查询 ---
业务流程测试失败: VM Exception while processing transaction: reverted with reason string 'Caller is not a property manager'
error Command failed with exit code 1.
info Visit https://yarnpkg.com/en/docs/cli/run for documentation about this command.
