我来帮你编写一个关于部署脚本的文档。首先让我查看一下相关的部署脚本：


Read file: /Users/zhangandy/Documents/work/code/party/blockchain/fashi-shijian/japan-rwa/deploy.sh

Ran tool
让我为你编写一个完整的部署文档：

# 日本房地产代币化系统部署文档

## 1. 部署脚本概述

系统提供了完整的部署脚本集，用于在不同网络上部署智能合约。主要包含以下脚本：

- `deploy.sh`: 主部署脚本，用于协调整个部署流程
- `scripts/deploy.js`: 核心部署逻辑实现
- `scripts/deploy-token-implementation.js`: 代币实现合约部署
- `scripts/setup-roles.js`: 角色权限设置
- `scripts/verify.js`: 合约验证
- `scripts/force-deploy.js`: 强制部署（忽略已部署状态）
- `scripts/debug-token-creation.js`: 代币创建调试工具

## 2. 部署流程

### 2.1 前置条件

1. 确保已安装所需依赖：
```bash
npm install
```

2. 配置环境变量：
- 在项目根目录创建 `.env` 文件
- 配置必要的环境变量，如：
  ```
  PRIVATE_KEY=你的私钥
  ETHERSCAN_API_KEY=你的Etherscan API密钥
  ```

### 2.2 部署命令

基本部署命令：
```bash
./deploy.sh <network> [options]
```

#### 网络选项：
- `local`: 部署到本地开发网络
- `testnet`: 部署到测试网（Sepolia）
- `mainnet`: 部署到主网

#### 部署选项：
- `--strategy=<策略>`: 部署策略
  - `direct`: 直接部署
  - `upgradeable`: 可升级部署（默认）
  - `minimal`: 最小化部署
- `--verify`: 部署后验证合约
- `--force`: 强制部署（忽略已部署状态）
- `--no-roles`: 跳过角色设置
- `--skip-token-impl`: 跳过代币实现部署

### 2.3 部署示例

1. 本地开发环境部署：
```bash
./deploy.sh local --strategy=upgradeable
```

2. 测试网部署（带验证）：
```bash
./deploy.sh testnet --verify
```

3. 强制重新部署：
```bash
./deploy.sh local --force
```

## 3. 部署状态管理

### 3.1 部署状态文件

部署状态保存在 `scripts/deploy-state.json` 中，包含：
- 合约地址
- 部署时间
- 部署网络
- 部署策略

### 3.2 日志管理

部署日志保存在 `scripts/logging/` 目录下：
- `contracts.json`: 合约部署记录
- `transactions.json`: 交易记录
- `errors.json`: 错误日志

## 4. 合约验证

### 4.1 自动验证

使用 `--verify` 选项时，部署后会自动验证合约：
```bash
./deploy.sh testnet --verify
```

### 4.2 手动验证

可以单独运行验证脚本：
```bash
npx hardhat run scripts/verify.js --network <network>
```

## 5. 角色设置

### 5.1 自动设置

默认情况下，部署脚本会自动设置必要的角色权限。可以通过 `--no-roles` 选项跳过：
```bash
./deploy.sh local --no-roles
```

### 5.2 手动设置

可以单独运行角色设置脚本：
```bash
npx hardhat run scripts/setup-roles.js --network <network>
```

## 6. 代币实现部署

### 6.1 自动部署

默认情况下，部署脚本会自动部署代币实现合约。可以通过 `--skip-token-impl` 选项跳过：
```bash
./deploy.sh local --skip-token-impl
```

### 6.2 手动部署

可以单独运行代币实现部署脚本：
```bash
npx hardhat run scripts/deploy-token-implementation.js --network <network>
```

## 7. 故障排除

### 7.1 强制部署

如果遇到部署问题，可以使用强制部署：
```bash
./deploy.sh local --force
```

### 7.2 代币创建调试

如果代币创建出现问题，可以使用调试脚本：
```bash
npx hardhat run scripts/debug-token-creation.js --network <network>
```

## 8. 注意事项

1. 部署前确保：
   - 本地开发网络已启动（如果使用本地网络）
   - 账户中有足够的ETH支付gas费
   - 环境变量配置正确

2. 安全建议：
   - 不要在代码中硬编码私钥
   - 使用环境变量管理敏感信息
   - 部署前仔细检查合约代码

3. 网络选择：
   - 开发测试建议使用本地网络
   - 正式测试使用测试网
   - 确认无误后再部署到主网

## 9. 常见问题

1. 部署失败：
   - 检查网络连接
   - 确认账户余额
   - 查看错误日志

2. 验证失败：
   - 检查Etherscan API密钥
   - 确认合约代码未修改
   - 等待网络同步

3. 角色设置失败：
   - 确认账户权限
   - 检查合约地址
   - 查看交易状态

