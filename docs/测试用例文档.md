# 日本房产通证化系统测试用例文档

## 测试环境

- 测试框架: Hardhat + Waffle
- 测试网络: Hardhat本地网络
- 测试账户: Hardhat默认提供的测试账户

## 单元测试

### RoleManager测试

| 测试用例ID | 测试用例描述 | 预期结果 |
|------------|--------------|----------|
| RM-01 | 测试初始化函数 | 合约正确初始化，创建者获得超级管理员角色 |
| RM-02 | 测试授予角色 | 超级管理员可以授予其他账户角色 |
| RM-03 | 测试撤销角色 | 超级管理员可以撤销其他账户的角色 |
| RM-04 | 测试权限控制 | 非授权账户无法执行受限操作 |

### PropertyRegistry测试

| 测试用例ID | 测试用例描述 | 预期结果 |
|------------|--------------|----------|
| PR-01 | 测试房产注册 | 房产管理员可以注册新房产 |
| PR-02 | 测试房产审核 | 超级管理员可以审核房产 |
| PR-03 | 测试房产状态更新 | 可以正确更新房产状态 |
| PR-04 | 测试权限控制 | 非授权账户无法注册或审核房产 |

### TokenFactory测试

| 测试用例ID | 测试用例描述 | 预期结果 |
|------------|--------------|----------|
| TF-01 | 测试代币创建 | 可以为已审核房产创建代币 |
| TF-02 | 测试代币初始供应量 | 创建代币时正确铸造初始供应量 |
| TF-03 | 测试重复创建 | 无法为同一房产重复创建代币 |
| TF-04 | 测试权限控制 | 非房产管理员无法创建代币 |

### RealEstateToken测试

| 测试用例ID | 测试用例描述 | 预期结果 |
|------------|--------------|----------|
| RET-01 | 测试代币基本功能 | 代币支持标准ERC20操作 |
| RET-02 | 测试铸造功能 | 授权账户可以铸造新代币 |
| RET-03 | 测试销毁功能 | 授权账户可以销毁代币 |
| RET-04 | 测试转账限制 | 根据房产状态正确限制转账 |
| RET-05 | 测试快照功能 | 可以创建余额快照并查询历史余额 |

### Marketplace测试

| 测试用例ID | 测试用例描述 | 预期结果 |
|------------|--------------|----------|
| MP-01 | 测试创建订单 | 用户可以创建销售订单 |
| MP-02 | 测试完成订单 | 买家可以购买订单，代币和稳定币正确转移 |
| MP-03 | 测试取消订单 | 卖家可以取消自己的订单 |
| MP-04 | 测试费用收取 | 交易时正确收取交易费用 |

### RentDistributor测试

| 测试用例ID | 测试用例描述 | 预期结果 |
|------------|--------------|----------|
| RD-01 | 测试创建分配 | 管理员可以创建租金分配 |
| RD-02 | 测试领取租金 | 代币持有者可以领取应得租金 |
| RD-03 | 测试重复领取 | 无法重复领取同一分配的租金 |
| RD-04 | 测试费用扣除 | 正确扣除平台费用和维护费用 |

### RedemptionManager测试

| 测试用例ID | 测试用例描述 | 预期结果 |
|------------|--------------|----------|
| RDM-01 | 测试发起赎回 | 管理员可以发起赎回流程 |
| RDM-02 | 测试请求赎回 | 代币持有者可以请求赎回 |
| RDM-03 | 测试处理赎回 | 管理员可以处理赎回请求 |
| RDM-04 | 测试费用扣除 | 正确扣除赎回费用 |

### FeeManager测试

| 测试用例ID | 测试用例描述 | 预期结果 |
|------------|--------------|----------|
| FM-01 | 测试费用设置 | 超级管理员可以更新各类费用 |
| FM-02 | 测试费用计算 | 正确计算各类费用金额 |
| FM-03 | 测试费用收集者更新 | 可以更新费用收集地址 |

### TokenHolderQuery测试

| 测试用例ID | 测试用例描述 | 预期结果 |
|------------|--------------|----------|
| THQ-01 | 测试查询持有者 | 可以查询代币持有者列表 |
| THQ-02 | 测试查询快照余额 | 可以查询特定快照时的余额 |

## 集成测试

### 完整业务流程测试

| 测试用例ID | 测试用例描述 | 预期结果 |
|------------|--------------|----------|
| INT-01 | 测试房产注册到代币创建 | 完整流程正常执行 |
| INT-02 | 测试代币交易流程 | 完整流程正常执行 |
| INT-03 | 测试租金分配流程 | 完整流程正常执行 |
| INT-04 | 测试赎回流程 | 完整流程正常执行 |

### 系统升级测试

| 测试用例ID | 测试用例描述 | 预期结果 |
|------------|--------------|----------|
| UPG-01 | 测试合约升级 | 可以成功升级各个合约 |
| UPG-02 | 测试升级后功能 | 升级后合约功能正常 |

## 测试执行

### 运行测试

```bash
# 运行所有测试
npx hardhat test

# 运行特定测试文件
npx hardhat test test/RoleManager.test.js

# 运行带有覆盖率报告的测试
npx hardhat coverage