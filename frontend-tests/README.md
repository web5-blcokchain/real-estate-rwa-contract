# 日本房产代币化平台前端测试工具

## 项目概述

前端测试工具是一个专门为日本房产代币化平台设计的自动化测试框架，用于验证前端应用与智能合约交互的正确性和可靠性。该工具模拟用户在前端界面上进行的各种操作，通过与区块链网络上的智能合约直接交互，测试整个系统的功能完整性。

### 主要功能

- **完整业务流程测试** - 测试从房产注册到代币化的全流程
- **代币交易测试** - 验证代币的创建、买卖、转让等交易功能
- **租金分配测试** - 测试租金分配和领取流程
- **角色权限测试** - 验证不同角色（管理员、运营者、财务等）的权限控制
- **边界条件测试** - 测试各种异常情况和边界条件下的系统行为

## 技术架构

前端测试工具基于以下技术和组件构建：

- **Ethers.js** - 用于与以太坊网络交互
- **共享工具库** - 利用项目中的共享工具（如合约服务、交易处理等）
- **模块化测试** - 测试用例按功能模块分离，便于维护和扩展
- **配置驱动设计** - 通过配置文件定制测试参数和环境设置

## 目录结构

```
frontend-tests/
├── config/              # 测试配置文件
│   └── index.js         # 配置入口文件
├── scripts/             # 测试脚本和工具
│   ├── contractService.js  # 合约服务
│   ├── run-single-test.js  # 单个测试执行脚本
│   └── run-tests.js     # 测试执行入口
├── tests/               # 测试用例
│   ├── property-flow.test.js   # 房产流程测试
│   ├── token-trading.test.js   # 代币交易测试
│   ├── rent-distribution.test.js # 租金分配测试
│   ├── redemption-flow.test.js   # 赎回流程测试
│   └── token-holder-query.test.js # 代币持有人查询测试
└── README.md            # 文档说明
```

## 安装与配置

### 前提条件

- Node.js (v14.x 或更高版本)
- yarn 或 npm 包管理器
- 本地运行的以太坊节点（Hardhat网络、Ganache等）或测试网连接

### 安装步骤

1. 克隆项目仓库
   ```bash
   git clone <项目仓库URL>
   cd japan-rwa
   ```

2. 安装依赖
   ```bash
   yarn install
   # 或
   npm install
   ```

3. 设置环境变量
   - 复制 `.env.example` 文件为 `.env`
   - 根据需要修改环境变量，特别是区块链网络连接和测试账户信息

### 配置说明

测试工具的配置位于 `frontend-tests/config/index.js` 文件中，主要配置项包括：

- **网络配置** - 区块链网络连接参数
- **合约地址** - 智能合约地址（从共享配置导入）
- **测试账户** - 不同角色的账户私钥
- **测试数据** - 测试用的房产信息、代币参数、租金金额等
- **超时设置** - 测试操作的超时时间
- **日志级别** - 测试日志的详细程度

可以通过修改该配置文件或设置环境变量来定制测试行为。

## 测试执行

### 运行所有测试

```bash
yarn test:frontend
# 或
npm run test:frontend
```

### 运行单个测试

```bash
node frontend-tests/scripts/run-single-test.js [测试文件路径]
# 例如
node frontend-tests/scripts/run-single-test.js property-flow
```

## 测试流程详解

### 1. 房产注册与代币化流程

房产注册到代币化的完整流程测试（`property-flow.test.js`）包括以下步骤：

1. 运营人员注册房产信息
2. 管理员审核并批准房产
3. 创建房产对应的代币
4. 将指定用户添加到代币白名单

### 2. 代币交易流程

代币交易测试（`token-trading.test.js`）验证以下功能：

1. 在交易市场创建代币卖单
2. 用户购买代币
3. 验证用户代币余额

### 3. 租金分配流程

租金分配测试（`rent-distribution.test.js`）包括：

1. 财务人员分配租金到代币合约
2. 代币持有者（用户）领取租金
3. 验证租金分配的正确性

### 4. 赎回流程（待实现）

赎回流程测试（`redemption-flow.test.js`）将测试：

1. 发起赎回请求
2. 代币持有者投票
3. 执行赎回操作

### 5. 代币持有人查询（待实现）

代币持有人查询测试（`token-holder-query.test.js`）将测试：

1. 查询特定代币的持有人列表
2. 查询持有人的代币余额
3. 验证数据的准确性

## 扩展与定制

### 添加新测试

1. 在 `tests/` 目录下创建新的测试文件
2. 导入必要的模块和服务
3. 实现测试逻辑
4. 导出测试函数
5. 在 `run-tests.js` 中添加新测试的引用和执行代码

### 修改测试数据

可以通过更新 `config/index.js` 文件中的 `testData` 对象来修改测试使用的数据。

## 常见问题

### 测试执行失败

- 检查区块链网络连接是否正常
- 确认合约地址是否正确
- 验证测试账户是否有足够的ETH余额
- 检查角色权限是否正确设置

### 合约交互错误

- 确保合约已正确部署
- 验证ABI文件是否最新
- 检查交易参数是否正确

## 最佳实践

- 在开发新功能后，同时更新或添加相应的测试用例
- 定期运行测试套件，确保系统稳定性
- 在测试后清理测试数据，避免影响其他测试
- 使用独立的测试网络或每次测试前重置本地网络状态 